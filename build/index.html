<html>
  <head>
    <script src="index.js"></script>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>

    <p>Welcome to the tracked object generator!</p>

    <p>Using this website, you can use and create <a href="https://github.com/samuelgoto/arpub">AR landmarks</a> from images. You can use (and improve) one of these:</p>

    <ul id="classes">
    </ul>

    <p>Or, if none of those are what you are looking for, you can create your own:</p>

    <ol>
      <li>You search for pictures on flickr</li>
      <li>We'll show you the pictures and you tell us if they match what you are trying to trigger on or not</li>
      <li>Using the data you collected, we'll create a JSON-LD that you can embed as a <a href="https://github.com/samuelgoto/arpub">landmark</a></li>
      <li>Using your web camera, you can see if it works</li>
    </ol>


    <script src="https://www.gstatic.com/firebasejs/5.4.2/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyBPI7s0SNoxkVJff12DbzRMWbMOu-fIVuU",
        authDomain: "class-f751c.firebaseapp.com",
        databaseURL: "https://class-f751c.firebaseio.com",
        projectId: "class-f751c",
        storageBucket: "",
        messagingSenderId: "52068356773"
      };
      firebase.initializeApp(config);
      let db = firebase.database();

      class Database {
        static write(key, value) {
          return new Promise(function(resolve, reject) {
            db.ref(key).set(value, function (error) {
              if (error) {
                reject();
                return;
              }
              resolve(value);
            });     
          });
        }


        static read(key) {
          return new Promise(function(resolve, reject) {
            db.ref(key).once("value").then(function(snapshot) {
              // console.log(snapshot.val());
              resolve(snapshot.val());
            });
          });
        }
      }

      // Database.write("foo", "hello");
      // Database.read("foo").then(value => console.log(value));

      // Database.write("/classes/coke", {hello2: "world"});
      // Database.read("/classes/").then(value => console.log(value));
      // db.ref("/classes/").orderByKey().once("value");
      async function list() {
        let classes = await Database.read("/classes/");
        console.log(classes);
        let ul = document.getElementById("classes");

        for (let clazz in classes) {
          let li = document.createElement("li");
          li.innerHTML = `<a href="javascript:alert('TODO: implement this;')">${clazz}</a>`;
          ul.appendChild(li);
        }
      }

      list();

    </script>

    <p>Ready? Set? </p> <input id="search" value="coke can"><button onclick="go()">go!</button>

    <p>Does this <a href="#" onclick="test()">work</a>?</p>

    <p>Here is the result (with an initial example of coke cans):</p>

    <textarea id="result" rows="30" cols="80">

{
  "@context": "http://w3c.org/ns/ar",
  "@type": "TrackedObject",
  "@id": "http://localhost:8080/build/index.html/coke can",
  "name": "coke can",
  "positive": [
    "https://farm4.staticflickr.com/3263/2715456390_f872644c9a.jpg",
    "https://farm9.staticflickr.com/8486/8216799178_b189caa2b8.jpg",
    "https://farm3.staticflickr.com/2025/2434595998_e39702b211.jpg",
    "https://farm1.staticflickr.com/29/88587924_f06f3e1f48.jpg",
    "https://farm9.staticflickr.com/8514/8417085434_2c92d10301.jpg",
    "https://farm5.staticflickr.com/4067/4414153408_f9a347a15a.jpg",
    "https://farm3.staticflickr.com/2558/4104942788_744bb6dccf.jpg",
    "https://farm6.staticflickr.com/5135/5390433735_829b09ae8f.jpg",
    "https://farm6.staticflickr.com/5051/5471519925_395c4b451a.jpg",
    "https://farm9.staticflickr.com/8144/7142865537_a26290e0cb.jpg",
    "https://farm1.staticflickr.com/139/383022842_5b59f381dd.jpg",
    "https://farm6.staticflickr.com/5714/23551699075_865f0f5d2e.jpg",
    "https://farm9.staticflickr.com/8192/8126411949_0465f6673c.jpg",
    "https://farm8.staticflickr.com/7513/16204419132_9dcc3f07fa.jpg",
    "https://farm1.staticflickr.com/150/383235610_f3e0600103.jpg",
    "https://farm4.staticflickr.com/3573/3394622202_4a52b85e2a.jpg",
    "https://farm5.staticflickr.com/4045/5163428306_4116758cf2.jpg",
    "https://farm5.staticflickr.com/4082/5433317575_fcec98384f.jpg",
    "https://farm3.staticflickr.com/2290/2198719112_496e816c49.jpg",
    "https://farm8.staticflickr.com/7190/6914678089_4e2d5938b4.jpg",
    "https://farm6.staticflickr.com/5070/5740294941_def2540888.jpg",
    "https://farm9.staticflickr.com/8239/8494704038_db0a9320e9.jpg",
    "https://farm5.staticflickr.com/4135/4831636806_0ec5efed78.jpg",
    "https://farm9.staticflickr.com/8684/17084430458_0f78d330cc.jpg",
    "https://farm8.staticflickr.com/7286/8727268673_61425ec571.jpg",
    "https://farm9.staticflickr.com/8401/8677729984_43d7fd9527.jpg",
    "https://farm7.staticflickr.com/6130/5985016635_bddef9bb8a.jpg",
    "https://farm3.staticflickr.com/2846/11455765344_6d1026d2af.jpg",
    "https://farm5.staticflickr.com/4011/5127141188_4a7cc9d624.jpg",
    "https://farm6.staticflickr.com/5039/5805170577_38d3323a2b.jpg",
    "https://farm4.staticflickr.com/3790/8755426387_a840d4d457.jpg",
    "https://farm5.staticflickr.com/4012/4669737791_ed042f6079.jpg",
    "https://farm3.staticflickr.com/2184/2045340662_18e9fabafa.jpg",
    "https://farm5.staticflickr.com/4143/4819351597_14f7452d6f.jpg",
    "https://farm9.staticflickr.com/8315/8062937170_ff4732ac1a.jpg",
    "https://farm9.staticflickr.com/8289/7684091078_a116b2d2a8.jpg",
    "https://farm3.staticflickr.com/2100/2094032101_d8fb5ffbf0.jpg",
    "https://farm3.staticflickr.com/2577/3933069528_bcddcacd69.jpg",
    "https://farm6.staticflickr.com/5451/7062921063_d5d5016a0b.jpg",
    "https://farm4.staticflickr.com/3344/3331346496_d7b78e4526.jpg",
    "https://farm6.staticflickr.com/5129/5334302270_83e136f3dc.jpg",
    "https://farm7.staticflickr.com/6227/6366288889_d27962c278.jpg",
    "https://farm8.staticflickr.com/7068/6852461181_f3e0926c58.jpg",
    "https://farm4.staticflickr.com/3419/3362609276_711f7cb18b.jpg",
    "https://farm4.staticflickr.com/3871/14910648272_83201123a6.jpg",
    "https://farm5.staticflickr.com/4081/4830330923_e2cc822f85.jpg",
    "https://farm7.staticflickr.com/6145/5939088156_f736d23b8d.jpg",
    "https://farm8.staticflickr.com/7347/12872124173_646fe4f5d5.jpg",
    "https://farm3.staticflickr.com/2419/1969104629_991e342669.jpg",
    "https://farm9.staticflickr.com/8728/16628821304_d9b26fa54a.jpg",
    "https://farm5.staticflickr.com/4078/5450572640_904eeafd8a.jpg",
    "https://farm8.staticflickr.com/7222/6969762430_25a13e0a36.jpg",
    "https://farm8.staticflickr.com/7036/6922956403_55e957a11f.jpg",
    "https://farm4.staticflickr.com/3789/10565794873_54ba9f77cf.jpg",
    "https://farm6.staticflickr.com/5446/10274033525_0128201aaf.jpg",
    "https://farm4.staticflickr.com/3375/3344281992_66f0937718.jpg",
    "https://farm4.staticflickr.com/3077/2597104518_31bcd0cd21.jpg",
    "https://farm6.staticflickr.com/5060/5549159517_c11cae343f.jpg",
    "https://farm5.staticflickr.com/4118/4892221145_fda0850bee.jpg",
    "https://farm3.staticflickr.com/2909/14581923334_f6104a69e0.jpg",
    "https://farm3.staticflickr.com/2415/2346807238_05645d841a.jpg",
    "https://farm8.staticflickr.com/7027/6697639605_207c0c8c29.jpg",
    "https://farm4.staticflickr.com/3787/10690305076_757cbbc43e.jpg",
    "https://farm1.staticflickr.com/116/311860160_58e4d23de0.jpg",
    "https://farm8.staticflickr.com/7143/6715507995_899776cf5f.jpg",
    "https://farm9.staticflickr.com/8447/7758020336_b007ea19b0.jpg",
    "https://farm8.staticflickr.com/7256/6996228676_4815ab8096.jpg",
    "https://farm5.staticflickr.com/4134/4787221534_f25440d85c.jpg",
    "https://farm4.staticflickr.com/3053/2847762823_8ec7d9e681.jpg",
    "https://farm9.staticflickr.com/8022/7384125412_112b360825.jpg",
    "https://farm4.staticflickr.com/3256/3229605823_0d2f9ab2bb.jpg",
    "https://farm9.staticflickr.com/8517/8570001424_465a31d508.jpg",
    "https://farm3.staticflickr.com/2883/13503698534_0a135147ef.jpg",
    "https://farm4.staticflickr.com/3232/2460345690_ce235179e4.jpg",
    "https://farm6.staticflickr.com/5252/5456146513_f2f097673f.jpg",
    "https://farm3.staticflickr.com/2548/4056703174_432e2ea8f1.jpg",
    "https://farm3.staticflickr.com/2865/12868169024_1fd7ae5014.jpg",
    "https://farm8.staticflickr.com/7335/9598257453_35bd172e20.jpg",
    "https://farm8.staticflickr.com/7148/6395628065_4bd5b4ebd9.jpg",
    "https://farm5.staticflickr.com/4138/4892210561_b93c2ee5f2.jpg",
    "https://farm4.staticflickr.com/3832/12615220573_f65ee2f4f2.jpg",
    "https://farm6.staticflickr.com/5009/5201008363_ede74812b9.jpg",
    "https://farm6.staticflickr.com/5256/5426191835_57d9773b13.jpg",
    "https://farm6.staticflickr.com/5022/5629414854_83610302a9.jpg",
    "https://farm6.staticflickr.com/5030/5728037531_549a9a8808.jpg",
    "https://farm6.staticflickr.com/5213/5411339866_e3ee5b53c4.jpg",
    "https://farm4.staticflickr.com/3034/2650921116_0907283dd7.jpg",
    "https://farm2.staticflickr.com/1165/1122159696_0766a7997b.jpg",
    "https://farm4.staticflickr.com/3258/2725181715_29df2c1ae2.jpg",
    "https://farm4.staticflickr.com/3030/3062203266_fc51432830.jpg",
    "https://farm2.staticflickr.com/1155/1344439867_84c578f6ba.jpg",
    "https://farm6.staticflickr.com/5214/5387519947_9568505276.jpg",
    "https://farm2.staticflickr.com/1242/877080568_10be68259e.jpg",
    "https://farm3.staticflickr.com/2055/2483400100_8b647194fc.jpg",
    "https://farm3.staticflickr.com/2576/3817962327_2397f146fc.jpg",
    "https://farm4.staticflickr.com/3436/3351045916_35ec2622c4.jpg",
    "https://farm1.staticflickr.com/28/64616092_fa04d2b3de.jpg",
    "https://farm1.staticflickr.com/207/499499460_b15a08b038.jpg",
    "https://farm3.staticflickr.com/2557/3771483615_2347db8192.jpg",
    "https://farm9.staticflickr.com/8298/7964089678_ee169d8a63.jpg",
    "https://farm3.staticflickr.com/2437/3777567354_0c19fd5dd1.jpg",
    "https://farm1.staticflickr.com/26/48274593_74c1ce0183.jpg",
    "https://farm4.staticflickr.com/3525/3190227956_ae14305ed4.jpg",
    "https://farm3.staticflickr.com/2205/2381166244_2d73aaca27.jpg",
    "https://farm4.staticflickr.com/3774/10534535695_660b63b69f.jpg",
    "https://farm9.staticflickr.com/8194/8437019182_6a38018b29.jpg",
    "https://farm9.staticflickr.com/8591/15399902413_b45cea32dd.jpg",
    "https://farm9.staticflickr.com/8665/15961681602_ed5e91cfe5.jpg",
    "https://farm8.staticflickr.com/7149/6773335815_3de003104d.jpg",
    "https://farm3.staticflickr.com/2405/2362097400_fcb2e4288f.jpg",
    "https://farm8.staticflickr.com/7791/17059918283_7d3b6f8daf.jpg",
    "https://farm9.staticflickr.com/8779/16885216157_e17e710dd0.jpg",
    "https://farm7.staticflickr.com/6063/6042904860_6264fa425f.jpg",
    "https://farm4.staticflickr.com/3267/4595941473_6650f6802c.jpg"
],
  "negative": [
    "https://farm5.staticflickr.com/4039/4694986934_aacced5fdd.jpg",
    "https://farm5.staticflickr.com/4129/5192158069_e2f443c25c.jpg",
    "https://farm2.staticflickr.com/1596/24970270235_4b4848b02f.jpg",
    "https://farm9.staticflickr.com/8076/8415988563_5e679944bb.jpg",
    "https://farm8.staticflickr.com/7459/14065931981_e3fbf5ebd9.jpg",
    "https://farm4.staticflickr.com/3029/2930910263_b32b3ed408.jpg",
    "https://farm4.staticflickr.com/3144/2859981714_c82940b8b8.jpg",
    "https://farm4.staticflickr.com/3696/19358621448_592a1a8ecc.jpg",
    "https://farm8.staticflickr.com/7441/8904846371_67d60f104e.jpg",
    "https://farm9.staticflickr.com/8376/8410015310_5fcf6b49b7.jpg",
    "https://farm1.staticflickr.com/154/429813787_bf31f81963.jpg",
    "https://farm3.staticflickr.com/2904/14176400987_7c2da3a6d2.jpg",
    "https://farm9.staticflickr.com/8152/6957680336_0a7e82ac85.jpg",
    "https://farm4.staticflickr.com/3741/10534200894_38c9641696.jpg",
    "https://farm4.staticflickr.com/3211/3155296225_af0aac36d0.jpg",
    "https://farm3.staticflickr.com/2399/2116833146_ecbc00cc0a.jpg",
    "https://farm1.staticflickr.com/48/174495691_e6ecb021a2.jpg",
    "https://farm4.staticflickr.com/3151/2425096997_7565c2d814.jpg",
    "https://farm6.staticflickr.com/5108/5744059697_b833c99fb4.jpg",
    "https://farm4.staticflickr.com/3572/3384329878_cb347cd75b.jpg",
    "https://farm9.staticflickr.com/8178/7889990048_c5242307b8.jpg",
    "https://farm6.staticflickr.com/5564/14972702786_ee42a806dc.jpg",
    "https://farm8.staticflickr.com/7157/6816449989_31cfa6c565.jpg",
    "https://farm6.staticflickr.com/5289/5292478484_f2f3639df5.jpg",
    "https://farm8.staticflickr.com/7285/9475606277_6307159570.jpg",
    "https://farm4.staticflickr.com/3634/3490405090_096fc34fe3.jpg",
    "https://farm8.staticflickr.com/7324/9345290308_f37c5f42f3.jpg",
    "https://farm4.staticflickr.com/3098/2475361936_c7ccbaac84.jpg",
    "https://farm3.staticflickr.com/2756/4398122327_aa51972b39.jpg",
    "https://farm6.staticflickr.com/5001/5305441377_eafc7ebf74.jpg",
    "https://farm4.staticflickr.com/3024/3508147852_4a1507dbbe.jpg",
    "https://farm7.staticflickr.com/6076/6136924654_cac05608d9.jpg",
    "https://farm8.staticflickr.com/7409/12012503155_c43e87a672.jpg",
    "https://farm3.staticflickr.com/2632/4015409988_b860274547.jpg",
    "https://farm4.staticflickr.com/3545/3862401835_3a1cd47993.jpg",
    "https://farm5.staticflickr.com/4133/5062572168_ee909fab9f.jpg",
    "https://farm6.staticflickr.com/5142/5579710482_a01ac212a8.jpg",
    "https://farm4.staticflickr.com/3177/2648312524_79483c0dca.jpg",
    "https://farm4.staticflickr.com/3074/3105528743_825d55a067.jpg",
    "https://farm2.staticflickr.com/1358/727782850_42105916e0.jpg",
    "https://farm1.staticflickr.com/46/124889487_335ea5544e.jpg",
    "https://farm4.staticflickr.com/3183/5705430467_a686dd8d5c.jpg",
    "https://farm8.staticflickr.com/7019/6754134991_610bc37638.jpg",
    "https://farm6.staticflickr.com/5016/5450979604_9062ae634f.jpg",
    "https://farm7.staticflickr.com/6077/6078921105_03720b4a98.jpg",
    "https://farm1.staticflickr.com/21/25755611_329d258fc9.jpg",
    "https://farm4.staticflickr.com/3546/3344242586_f91d137886.jpg",
    "https://farm6.staticflickr.com/5271/5845262572_255c1bd253.jpg",
    "https://farm5.staticflickr.com/4056/4675190606_c9ebd16395.jpg",
    "https://farm4.staticflickr.com/3291/2827575052_bf2d2cb55d.jpg",
    "https://farm6.staticflickr.com/5180/5403351005_b27b2f5ec3.jpg",
    "https://farm4.staticflickr.com/3004/2768729614_ced8d8f87f.jpg",
    "https://farm1.staticflickr.com/46/131977405_a37d186fcf.jpg",
    "https://farm4.staticflickr.com/3255/3092595090_5b757c6ae4.jpg",
    "https://farm5.staticflickr.com/4095/4934010276_ba2fe65041.jpg",
    "https://farm4.staticflickr.com/3664/3424026679_821d3d325c.jpg",
    "https://farm4.staticflickr.com/3179/2713563605_86fe1bb829.jpg",
    "https://farm6.staticflickr.com/5087/5298859115_2e731b3a1f.jpg",
    "https://farm4.staticflickr.com/3163/2375470922_964dc4a17c.jpg",
    "https://farm4.staticflickr.com/3936/15279719269_6fb0fdbb87.jpg",
    "https://farm4.staticflickr.com/3050/2678465255_7d68b62fb8.jpg",
    "https://farm4.staticflickr.com/3327/3496294590_3ef67fe746.jpg",
    "https://farm4.staticflickr.com/3531/3806251079_eae06bbcab.jpg",
    "https://farm5.staticflickr.com/4008/4346104639_5b0211598c.jpg",
    "https://farm1.staticflickr.com/22/26126899_e4f864aeef.jpg",
    "https://farm5.staticflickr.com/4031/4580871172_302785f241.jpg",
    "https://farm3.staticflickr.com/2784/4382938277_d3ae443a66.jpg",
    "https://farm6.staticflickr.com/5323/7409288092_8231008bcf.jpg",
    "https://farm6.staticflickr.com/5148/5602772650_ca3f3a0e3c.jpg",
    "https://farm5.staticflickr.com/4074/4899767975_485caac071.jpg",
    "https://farm1.staticflickr.com/159/352184583_1bf37c6c54.jpg",
    "https://farm4.staticflickr.com/3063/2319322997_d1a31de71b.jpg",
    "https://farm7.staticflickr.com/6196/6055808294_5d3aa61c7e.jpg",
    "https://farm5.staticflickr.com/4089/5034297852_f833a9ac35.jpg",
    "https://farm8.staticflickr.com/7350/12337137815_70d1a32ca4.jpg",
    "https://farm8.staticflickr.com/7548/15948528239_195d2bd786.jpg",
    "https://farm4.staticflickr.com/3825/9711350222_03ea4aa3e6.jpg",
    "https://farm4.staticflickr.com/3856/14724443347_b3995b5e56.jpg",
    "https://farm3.staticflickr.com/2290/2459508753_c9f0afd6cd.jpg",
    "https://farm8.staticflickr.com/7175/6734793113_00b347a238.jpg",
    "https://farm7.staticflickr.com/6230/6334976326_7374bd5d15.jpg",
    "https://farm8.staticflickr.com/7038/6805152806_59de393a8f.jpg",
    "https://farm3.staticflickr.com/2458/4015411536_db038d7404.jpg",
    "https://farm7.staticflickr.com/6134/5919650008_65eba854ca.jpg",
    "https://farm1.staticflickr.com/137/334571054_50b998581e.jpg",
    "https://farm4.staticflickr.com/3213/2332294939_b916941d11.jpg",
    "https://farm2.staticflickr.com/1445/25822224601_7b68ffc7f3.jpg",
    "https://farm9.staticflickr.com/8146/7408557412_af85c3034b.jpg",
    "https://farm3.staticflickr.com/2160/2323661330_7156a9d71d.jpg",
    "https://farm3.staticflickr.com/2145/2194901491_6f218d59a7.jpg",
    "https://farm5.staticflickr.com/4102/4900898886_df3ec84bf0.jpg",
    "https://farm4.staticflickr.com/3111/2833004744_7313d8c28f.jpg",
    "https://farm8.staticflickr.com/7283/8728459066_c17d992f2b.jpg",
    "https://farm9.staticflickr.com/8145/7551906656_eb6c501b66.jpg",
    "https://farm4.staticflickr.com/3329/3428828393_2491a09bf7.jpg",
    "https://farm9.staticflickr.com/8518/8393110911_3292932520.jpg",
    "https://farm5.staticflickr.com/4095/4892809218_c14ea8775c.jpg",
    "https://farm3.staticflickr.com/2139/2500007256_a352570632.jpg",
    "https://farm4.staticflickr.com/3047/2982033571_714f015be5.jpg",
    "https://farm4.staticflickr.com/3009/2509878327_ca3e3a35b8.jpg",
    "https://farm2.staticflickr.com/1164/841901548_49ce2ff390.jpg",
    "https://farm4.staticflickr.com/3114/3230461960_e538486e79.jpg",
    "https://farm6.staticflickr.com/5341/10273955374_aaed5646f1.jpg",
    "https://farm6.staticflickr.com/5161/5303186748_45a0eaf817.jpg",
    "https://farm4.staticflickr.com/3101/2517373446_e23e93e151.jpg",
    "https://farm3.staticflickr.com/2040/2515888681_2bb14948e5.jpg",
    "https://farm3.staticflickr.com/2004/2457843379_eb9b0cf1b7.jpg",
    "https://farm1.staticflickr.com/266/31794117693_224f63b26c.jpg",
    "https://farm6.staticflickr.com/5143/5600147043_12febf12d3.jpg",
    "https://farm5.staticflickr.com/4134/4779965661_5b973b645d.jpg",
    "https://farm4.staticflickr.com/3496/3469501425_36cced1732.jpg",
    "https://farm4.staticflickr.com/3273/3021539575_24a4793619.jpg",
    "https://farm5.staticflickr.com/4020/4650853806_5129ccbee4.jpg",
    "https://farm4.staticflickr.com/3392/3194369353_6497b39d8e.jpg",
    "https://farm5.staticflickr.com/4093/4781904135_98f2c7e6b5.jpg",
    "https://farm1.staticflickr.com/174/415380359_221f3cc3a6.jpg",
    "https://farm6.staticflickr.com/5074/5793946707_689f1152f7.jpg",
    "https://farm5.staticflickr.com/4123/4808889270_ca0975fb71.jpg",
    "https://farm4.staticflickr.com/3609/3413514567_6e7f368d94.jpg",
    "https://farm5.staticflickr.com/4098/5441667795_b60d08fee2.jpg",
    "https://farm8.staticflickr.com/7041/7059592493_9ebc26c2a9.jpg",
    "https://farm1.staticflickr.com/226/494109521_429e02c16a.jpg",
    "https://farm5.staticflickr.com/4094/4917423653_30e143ed19.jpg",
    "https://farm4.staticflickr.com/3677/12043655184_fa1d0d2640.jpg",
    "https://farm5.staticflickr.com/4107/5192162975_2ba183c838.jpg",
    "https://farm3.staticflickr.com/2146/2086558168_5620dc08b7.jpg",
    "https://farm5.staticflickr.com/4111/4963491912_0e1a24f420.jpg",
    "https://farm1.staticflickr.com/186/408202746_4cdf2a3730.jpg",
    "https://farm4.staticflickr.com/3201/2291042053_3aa7c99612.jpg",
    "https://farm6.staticflickr.com/5511/10690325316_0c66d00a97.jpg",
    "https://farm8.staticflickr.com/7329/13083789574_d9c18d7da7.jpg",
    "https://farm6.staticflickr.com/5296/5502127211_9a03cfd863.jpg",
    "https://farm2.staticflickr.com/1137/1288800446_2ec038af66.jpg",
    "https://farm3.staticflickr.com/2420/2510223881_874d28d771.jpg",
    "https://farm4.staticflickr.com/3164/3045625277_da2b10c0e0.jpg",
    "https://farm7.staticflickr.com/6024/5965592180_261e56d7b4.jpg",
    "https://farm4.staticflickr.com/3036/13065711793_e26b2248e2.jpg",
    "https://farm9.staticflickr.com/8110/8472765932_ab220a02a7.jpg",
    "https://farm4.staticflickr.com/3839/14177056378_dbc2aeff88.jpg",
    "https://farm3.staticflickr.com/2301/2376621963_1eb9ef2c10.jpg",
    "https://farm3.staticflickr.com/2665/3808073152_af987d7571.jpg",
    "https://farm7.staticflickr.com/6148/6042218739_5824151a20.jpg",
    "https://farm5.staticflickr.com/4148/5085026940_5795ebf447.jpg",
    "https://farm8.staticflickr.com/7071/7094528563_f4a430d4c5.jpg",
    "https://farm7.staticflickr.com/6128/6042253669_83d5a4e6f7.jpg",
    "https://farm1.staticflickr.com/200/445080986_b702e3ddfc.jpg",
    "https://farm3.staticflickr.com/2909/14760964794_8034bb4c2a.jpg",
    "https://farm3.staticflickr.com/2179/2407969228_9dc2fee318.jpg",
    "https://farm8.staticflickr.com/7149/13570481355_5c30fb5418.jpg",
    "https://farm8.staticflickr.com/7213/7323341076_415e678982.jpg",
    "https://farm4.staticflickr.com/3207/3132157557_ae8e311bee.jpg",
    "https://farm6.staticflickr.com/5047/5260674465_0e91b14311.jpg",
    "https://farm6.staticflickr.com/5230/5659764051_b346d563ca.jpg",
    "https://farm4.staticflickr.com/3107/2731421461_f9b0ff349a.jpg",
    "https://farm6.staticflickr.com/5253/5491284971_2f46141e1b.jpg",
    "https://farm4.staticflickr.com/3572/3822978282_2a059da71b.jpg",
    "https://farm8.staticflickr.com/7293/10274083463_70ac07b30f.jpg",
    "https://farm8.staticflickr.com/7680/17689449340_20fc97010a.jpg",
    "https://farm4.staticflickr.com/3220/2943403278_6c0e427919.jpg",
    "https://farm4.staticflickr.com/3383/3635640697_e020af86d1.jpg",
    "https://farm1.staticflickr.com/79/234359900_a3826ced11.jpg",
    "https://farm5.staticflickr.com/4041/4636127014_bb4f5db291.jpg",
    "https://farm4.staticflickr.com/3149/2710606385_2c087b6ea4.jpg",
    "https://farm8.staticflickr.com/7324/27987162710_d6b93dc4ef.jpg",
    "https://farm1.staticflickr.com/42/80195477_a0b1bb37e9.jpg",
    "https://farm3.staticflickr.com/2675/4209729980_670958a7f1.jpg",
    "https://farm4.staticflickr.com/3248/2994480868_1d733efe31.jpg",
    "https://farm9.staticflickr.com/8725/16706020328_bfd377ae07.jpg",
    "https://farm4.staticflickr.com/3503/3297749462_2ff9a70013.jpg",
    "https://farm5.staticflickr.com/4017/4263668936_932062224f.jpg",
    "https://farm4.staticflickr.com/3059/2691147528_e523922ed5.jpg",
    "https://farm3.staticflickr.com/2452/4012029399_2766d510c0.jpg",
    "https://farm4.staticflickr.com/3910/14866992595_47f20be963.jpg",
    "https://farm7.staticflickr.com/6016/6205683076_c969a2db53.jpg",
    "https://farm4.staticflickr.com/3007/3037210864_66bfef61ff.jpg",
    "https://farm1.staticflickr.com/641/23064997852_bf2b558acc.jpg",
    "https://farm6.staticflickr.com/5784/23345169635_d7e081101a.jpg",
    "https://farm9.staticflickr.com/8369/8527374822_e751055108.jpg",
    "https://farm9.staticflickr.com/8511/8523545639_2effa8df20.jpg",
    "https://farm2.staticflickr.com/1625/23691710224_970a6627d2.jpg",
    "https://farm4.staticflickr.com/3759/11183792035_c5e6dc5037.jpg",
    "https://farm8.staticflickr.com/7261/8075105054_7fbe4fc34b.jpg",
    "https://farm4.staticflickr.com/3734/10942311216_bcbb856621.jpg",
    "https://farm3.staticflickr.com/2274/2199155210_718666270a.jpg"
]
}
</textarea>

    <style>
    </style>

    <div id="go" class="fullscreen">
      <div id="instructions" class="instructions"></div>
      <img id="image" crossorigin="anonymous" class="image">
      <video autoplay="true" id="camera"></video>
    </div>

    <script>
      const {Flickr} = module;

      async function instructions(message) {
        document.getElementById("instructions").innerHTML = message;
      }

      async function go() {
        let query = document.getElementById("search").value;

        if (!query) {
          alert(`invalid query [${query}]`);
          return;
        }

        document.getElementById("go").setAttribute("enabled", "labeling");

        let photos = await new Flickr().search(query, 300);
        // console.log(photos);

        if (photos.length < 10) { 
          alert(`Not enough examples found on flickr (${photos.length}). Search something else.`);
          document.getElementById("go").removeAttribute("enabled");
          return;
        }

        let i = 0;
       
        let image = (index) => {
          document.getElementById("image").src = photos[index];

          instructions(`
            <br>Image ${index} out of ${photos.length}.
            <br>Press 'J' if this image matches what you want to trigger on and 'K' if it doesn't. 
            <br>ESC to leave the training.
            <br>
          `);

            document.getElementById("result").innerText = `
{
  "@context": "http://w3c.org/ns/ar",
  "@type": "TrackedObject",
  "@id": "${document.location.href}/${query}",
  "name": "${query}",
  "positive": ${JSON.stringify(good, undefined, 4)},
  "negative": ${JSON.stringify(bad, undefined, 4)}
}
`;

        };

        let good = [];
        let bad = [];

        image(i);

        function keyboard(e) {
          // e.keyCode == 27 is ESC
          let char = String.fromCharCode(e.keyCode);

          if (char == "J" || char == "K") {
            let bucket = char == "J" ? good : bad;
            bucket.push(photos[i]);
            i++;
            image(i);
          }

          if (i == photos.length) {
            document.body.removeEventListener("keydown", keyboard);
            train();
          }
        }
  
        document.body.addEventListener("keydown", keyboard);
      }

      document.body.addEventListener("keydown", function(e) {
        if (e.keyCode != 27) {
          return;
        }
        document.getElementById("go").removeAttribute("enabled");
      });


      // go();

    </script>

    <canvas id="canvas" width="224" height="224"></canvas>

    <script>
      async function load(url) {
        let img = document.getElementById("image");
        let canvas = document.getElementById("canvas");
        return new Promise(function(resolve, reject) {
          img.src = url;
          img.onload = function() {
            let context = canvas.getContext("2d");
            context.drawImage(img, 0, 0, 224, 224);
            resolve(canvas);
          }
        });
      }

      let {DataFlow} = module;
      const url = "../test/mobilenet-features/";
      let dataflow = new DataFlow(
        url + "tensorflowjs_model.pb", 
        url + "weights_manifest.json");

      async function train() {
        document.getElementById("go").setAttribute("enabled", "training");
        let data = JSON.parse(document.getElementById("result").value);

        instructions("loading the embedding");

        await dataflow.load();

        instructions("loading positive examples into the KNN");

        for (let photo of data.positive) {
          let bin = await load(photo);
          // console.log(bin);
          await dataflow.addExample(bin, 0);
        }

        // instructions("loading negative examples into the KNN");

        // for (let photo of data.negative) {
        //  let bin = await load(photo);
        // console.log(bin);
        //  await dataflow.addExample(bin, 1);
        // }

        instructions("loading web camera");
 
        // console.log(leo);
        // let anna = await dataflow.addExample(await load("/test/anna.jpg"), 1);
        // console.log(anna);
 
        // let prediction = await dataflow.predict(await load("/test/anna2.jpg"));
        // console.log(prediction);
        // prediction.print();
        await run();
      }

      // train();
    </script>

    <script>

      async function screenshot() {
        let video = document.getElementById("camera");
        let canvas = document.getElementById("canvas");
        let context = canvas.getContext("2d");
        context.drawImage(video, 0, 0, 224, 224);
        return canvas;
      }

      async function run() {
        document.getElementById("go").setAttribute("enabled", "true");
        let video = document.getElementById("camera");

        let stream = await navigator.mediaDevices.getUserMedia({video: true});
        camera.srcObject = stream;

        let data = JSON.parse(document.getElementById("result").value);
        let image = document.getElementById("image");

        async function predict() {
          let bin = await screenshot();
          let prediction = await dataflow.predict(bin);
          let scores = await prediction.data();
          console.log(scores);

          let best = [];
          scores.map((score, i) => {
            best[i] = {score: score, i: i};
          });
          
          best.sort((a, b) => (b.score - a.score));

          // console.log(best);

          // displays the closest image
          let image = document.getElementById("image");
          image.src = data.positive[best[0].i];
          image.style.opacity = best[0].score;

          instructions(`cosine distance = ${best[0].score}%`);

          setTimeout(predict, 250);
        }

        video.onloadeddata = async function() {
          predict();
          // setTimeout(predict, 250);
        }
      }

      // run();

    </script>


    <!--
    <button onclick="register()">register</button>
    <button onclick="signin()">signin</button>
    -->

    <script>
      async function register() {
        console.log("registering");
        //let credentials = new FederatedCredential({
        //  id: "",
        //  name: "Sam Goto",
        //  provider: "https://sgo.to",
        //  iconURL: "https://pbs.twimg.com/profile_images/920758039325564928/vp0Px4kC_bigger.jpg"
        // });

        const credentials = new PasswordCredential({
          id: "reader",
          name: "Arnelle Balane",
          password: "myawesomepassword",
          iconURL: "https://pbs.twimg.com/profile_images/920758039325564928/vp0Px4kC_bigger.jpg"
        });

        // console.log(cred);

        let result = await navigator.credentials.store(credentials);
        console.log(result);
      }

      async function signin() {
        console.log("signing in");
        let result = await navigator.credentials.get({
          password: true,
          federated: {
            providers: ["https://sgo.to"]
          }
          });
        console.log(result);
      }


    </script>
    
  </body>
</html>
